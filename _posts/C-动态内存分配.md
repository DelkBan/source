---
title: 用new运算符实现动态内存分配
date: 2018-09-12 12:05:45
tags: 
- c++
- 语法
---

### 用法

##### 用法一：分配一个变量

`P = new T;`

其中`T`是任意类型名，`P`是类型为`T*`的指针。
<!--more-->
动态分配出一片大小为`sizeof(T)`字节的内存空间，并且将该内存空间的起始地址赋值给`P`。比如：

```
int * pn;
pn = new int;
* pn = 5;
```

上述初始化语句也可以合为一个：

` int * pn = new int ;`

##### 用法二：分配一个数组

`P = new T[N]`

`T`：任意**类型名**

`P`：类型为`T*`的指针

`N`：要分配的数组元素的个数，可以是整型表达式

动态分配出一片大小为**`sizeof(T)*N`**字节的内存空间，并且将该内存空间的**起始地址**赋值给`p`。

##### 一定要用delete运算符释放空间

用 `new` 动态分配的内存空间，一定要用 `delete` 运算符进行释放

**delete 指针**： 必须指向**new**出来的空间

```
int * p =new int;
* p = 5;
delete p;
delete p; //将会导致异常，一片空间不能被delete多次
```

**用delete释放动态分配的数组，要加"[]"：**

```
int * p =new int[20];
p[0] = 1;
delete [] p;
```

### 例题：神秘的数组初始化

##### 描述

填空，使得程序输出指定结果

```
#include <iostream>
using namespace std;

int main()
{
	int * a[] = {
// 在此处补充你的代码
};
	
	*a[2] = 123;
	a[3][5] = 456;
	if(! a[0] ) {
		cout << * a[2] << "," << a[3][5];
	}
	return 0;
}

```

##### 输入

无

##### 输出

123,456

##### 分析

` int * a[] `是定义了一个指针数组，即数组中存放的都是指针
` *a[2] = 123; `实际上是取了存放在a[2]中的地址的内容，因此数组在第三个位置处只需要1个量来存放地址，而前两个用不到，设为`NULL`
` a[3][5] =456； `可以理解为在数组a的第4个位置需要6个空间，因此需要`new int[6]`

##### 答案

初始化语句为:

**` int  * a[] = {NULL, NULL, new int[1], new int[6]}`**



